<!DOCTYPE html>
<html lang="pt-BR" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Direcionamento de Cirurgia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Estilo para a barra de rolagem */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .dark ::-webkit-scrollbar-track {
            background: #374151; /* gray-700 */
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body class="p-4 md:p-8 bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300">

    <div id="app" class="max-w-full mx-auto">
        <header class="mb-8 p-4 bg-white dark:bg-gray-800 rounded-lg shadow-md">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800 dark:text-gray-100">Direcionamento de Cirurgias</h1>
                    <p class="text-gray-600 dark:text-gray-400 mt-1">Gerencie tabelas e procedimentos de forma interativa.</p>
                </div>
                <div class="mt-4 md:mt-0 flex flex-wrap items-center justify-center gap-3">
                    <button id="add-table-btn" class="w-full sm:w-auto bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-blue-700 transition duration-300 ease-in-out">
                        Criar Tabela
                    </button>
                    <button id="save-btn" class="w-full sm:w-auto bg-green-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-green-700 transition duration-300 ease-in-out">
                        Salvar
                    </button>
                    <button id="export-btn" class="w-full sm:w-auto bg-purple-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-purple-700 transition duration-300 ease-in-out">
                        Exportar
                    </button>
                    <button id="reset-btn" class="w-full sm:w-auto bg-red-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-red-700 transition duration-300 ease-in-out">
                        Resetar
                    </button>
                     <button id="theme-toggle-btn" title="Alternar tema" class="p-2 rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 focus:outline-none">
                        <svg id="theme-toggle-moon-icon" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                        <svg id="theme-toggle-sun-icon" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                    </button>
                </div>
            </div>
             <div class="mt-4 p-3 bg-blue-100 dark:bg-gray-700 border-l-4 border-blue-500 text-blue-800 dark:text-blue-300 rounded-md">
                <p class="font-bold">Como funciona o salvamento?</p>
                <p>Suas alterações são salvas diretamente no seu navegador. Clique em <strong class="font-semibold">"Salvar"</strong> e seus dados estarão aqui quando você reabrir a página.</p>
            </div>
        </header>

        <main id="tables-container" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
            <!-- As tabelas de procedimentos serão inseridas aqui via JavaScript -->
        </main>
    </div>

    <!-- Modal Genérico -->
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md">
            <h3 id="modal-title" class="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-100"></h3>
            <div id="modal-content" class="text-gray-700 dark:text-gray-300">
                <!-- Conteúdo do modal (input ou texto de confirmação) -->
            </div>
            <div class="mt-6 flex justify-end gap-3">
                <button id="modal-cancel" class="bg-gray-300 dark:bg-gray-600 text-gray-800 dark:text-gray-100 font-semibold py-2 px-4 rounded-lg hover:bg-gray-400 dark:hover:bg-gray-500 transition">Cancelar</button>
                <button id="modal-confirm" class="bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700 transition">Confirmar</button>
            </div>
        </div>
    </div>


    <script>
        // Objeto com os dados iniciais extraídos do arquivo do usuário
        const initialData = [
            { title: "UROLOGIA PEQUENO", procedures: ["VASECTOMIA", "POSTECTOMIA", "CISTOSCOPIA", "VARICOCELE", "HIDROCELE"] },
            { title: "UROLOGIA MÉDIO", procedures: ["MEATOPLASTIA", "PROSTATECTOMIA", "CISTOTOMIA", "ORQUIECTOMIA", "URETERORRENOLITOTRIPSIA", "NEFRECTOMIA TOTAL", "URETROTOMIA", "RTU DE PRÓSTATA", "LOMBOTOMIA"] },
            { title: "UROLOGIA GRANDE", procedures: ["RADICAL DE PRÓSTATA", "NEFRECTOMIA", "PIELOPLASTIA", "RTU DE PRÓSTATA"] },
            { title: "PEQUENO PROCEDIMENTO", procedures: ["DRENAGEMDE ABCESSO", "BRONCOSCOPIA", "VARIZES", "EXERESE DE TUMOR DE PELE", "RECONSTRUÇÃO COM RETALHO MIOCUTÂNIO", "ENXERTO DE PELE", "EXCISÃO E SUTURA DE LESÃO NA PELE EM Z OU ROTACA", "Linfadenectomia inguinal"] },
            { title: "CÁRDIO", procedures: ["REVASCULARIZAÇÃO", "IMPLANTE DE PROTESE VALVAR"] },
            { title: "DESBRIDAMENTO", procedures: ["CURATIVO/DESBRIDAMENTO", "RESSUTURA DE PAREDE"] },
            { title: "EXODONTIA", procedures: ["EXODONTIA"] },
            { title: "TQT", procedures: ["TRAQUEOSTOMIA"] },
            { title: "NEURO", procedures: ["MICROCIRURGIA PARA TUMOR/ANEURISMA INTRACRANIANO/CRANIOTOMIA", "ARTRODESE CERVICAL"] },
            { title: "OTORRINO", procedures: ["AMIGDALECTOMIA"] },
            { title: "AMPUTAÇÃO", procedures: ["AMPUTAÇÃO"] },
            { title: "CPRE", procedures: ["COLANGIOPANCREATOGRAFIA"] }
        ];

        const tablesContainer = document.getElementById('tables-container');
        const saveBtn = document.getElementById('save-btn');
        const addTableBtn = document.getElementById('add-table-btn');
        const exportBtn = document.getElementById('export-btn');
        const resetBtn = document.getElementById('reset-btn');
        const themeToggleBtn = document.getElementById('theme-toggle-btn');
        const moonIcon = document.getElementById('theme-toggle-moon-icon');
        const sunIcon = document.getElementById('theme-toggle-sun-icon');
        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modal-title');
        const modalContent = document.getElementById('modal-content');
        const modalCancelBtn = document.getElementById('modal-cancel');
        const modalConfirmBtn = document.getElementById('modal-confirm');

        let onConfirmCallback = null;
        
        // --- Funções do Tema (Dark Mode) ---
        const applyTheme = (theme) => {
            if (theme === 'dark') {
                document.documentElement.classList.add('dark');
                moonIcon.classList.add('hidden');
                sunIcon.classList.remove('hidden');
            } else {
                document.documentElement.classList.remove('dark');
                moonIcon.classList.remove('hidden');
                sunIcon.classList.add('hidden');
            }
        };
        
        themeToggleBtn.addEventListener('click', () => {
            const isDark = document.documentElement.classList.contains('dark');
            const newTheme = isDark ? 'light' : 'dark';
            localStorage.setItem('theme', newTheme);
            applyTheme(newTheme);
        });


        // --- Funções do Modal ---
        const showModal = (title, contentHtml, confirmText = 'Confirmar', onConfirm) => {
            modalTitle.textContent = title;
            modalContent.innerHTML = contentHtml;
            modalConfirmBtn.textContent = confirmText;
            onConfirmCallback = onConfirm;
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            const input = modal.querySelector('input');
            if (input) input.focus();
        };

        const hideModal = () => {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            onConfirmCallback = null;
            modalContent.innerHTML = '';
        };

        modalCancelBtn.addEventListener('click', hideModal);
        modalConfirmBtn.addEventListener('click', () => { if (onConfirmCallback) onConfirmCallback(); });
        modal.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') { if (onConfirmCallback) onConfirmCallback(); } 
            else if (e.key === 'Escape') { hideModal(); }
        });


        // --- Funções de Renderização ---
        const createProcedureItemHTML = (text) => {
            return `
                <li class="procedure-item bg-white dark:bg-gray-800 flex justify-between items-center p-3 rounded-md shadow-sm mb-2" data-procedure-name="${text}">
                    <span class="procedure-text flex-1 pr-2 text-gray-800 dark:text-gray-200">${text}</span>
                    <div class="flex items-center gap-2">
                        <button class="edit-procedure-btn text-gray-500 hover:text-blue-600 dark:hover:text-blue-400" title="Editar procedimento">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                        </button>
                        <button class="delete-procedure-btn text-gray-500 hover:text-red-600 dark:hover:text-red-400" title="Deletar procedimento">
                           <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                        </button>
                    </div>
                </li>
            `;
        };

        const createTableHTML = (title, procedures = []) => {
            const tableEl = document.createElement('div');
            tableEl.className = 'procedure-table bg-gray-200 dark:bg-gray-700 rounded-xl p-4 shadow-lg flex flex-col h-full';
            tableEl.setAttribute('data-table-title', title);
            const proceduresHTML = procedures.map(proc => createProcedureItemHTML(proc)).join('');
            tableEl.innerHTML = `
                <header class="flex justify-between items-center mb-4 pb-2 border-b-2 border-gray-300 dark:border-gray-600">
                    <h2 class="table-title text-xl font-bold text-gray-700 dark:text-gray-200 flex-1 pr-2">${title}</h2>
                    <div class="flex items-center gap-2">
                        <button class="edit-table-btn text-gray-500 hover:text-blue-600 dark:hover:text-blue-400" title="Editar título da tabela">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                        </button>
                         <button class="delete-table-btn text-gray-500 hover:text-red-600 dark:hover:text-red-400" title="Deletar tabela">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 4H8l-7 8 7 8h13a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z"></path><line x1="18" y1="9" x2="12" y2="15"></line><line x1="12" y1="9" x2="18" y2="15"></line></svg>
                        </button>
                    </div>
                </header>
                <ul class="procedure-list flex-grow overflow-y-auto pr-1" style="max-height: 60vh;">
                    ${proceduresHTML}
                </ul>
                <footer class="mt-4">
                    <button class="add-procedure-btn w-full bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-200 font-semibold py-2 px-4 rounded-lg hover:bg-gray-400 dark:hover:bg-gray-500 transition">
                        Adicionar Procedimento
                    </button>
                </footer>
            `;
            return tableEl;
        };
        
        const renderAllTables = () => {
            tablesContainer.innerHTML = '';
            const savedData = localStorage.getItem('procedimentosData');
            let dataToRender = savedData ? JSON.parse(savedData) : initialData;
            dataToRender.forEach(tableData => {
                tablesContainer.appendChild(createTableHTML(tableData.title, tableData.procedures));
            });
        };

        // --- Funções de Manipulação do DOM ---
        const handleAddTable = () => {
            showModal('Criar Nova Tabela', '<input type="text" id="modal-input" class="w-full border rounded p-2 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200" placeholder="Nome da tabela">', 'Criar', () => {
                const input = document.getElementById('modal-input');
                const newTitle = input.value.trim();
                if (newTitle) {
                    tablesContainer.appendChild(createTableHTML(newTitle));
                    hideModal();
                } else {
                    alert('O nome da tabela não pode ser vazio.');
                }
            });
        };
        
        const handleEditTableTitle = (button) => {
            const tableEl = button.closest('.procedure-table');
            const titleEl = tableEl.querySelector('.table-title');
            const currentTitle = titleEl.textContent;
            showModal('Editar Título da Tabela', `<input type="text" id="modal-input" class="w-full border rounded p-2 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200" value="${currentTitle}">`, 'Salvar', () => {
                const input = document.getElementById('modal-input');
                const newTitle = input.value.trim();
                if (newTitle && newTitle !== currentTitle) {
                    titleEl.textContent = newTitle;
                    tableEl.setAttribute('data-table-title', newTitle);
                }
                hideModal();
            });
        };

        const handleDeleteTable = (button) => {
             const tableEl = button.closest('.procedure-table');
             const title = tableEl.dataset.tableTitle;
             showModal('Deletar Tabela', `<p>Você tem certeza que quer deletar a tabela "<strong>${title}</strong>"? Esta ação não pode ser desfeita.</p>`, 'Deletar', () => {
                 tableEl.remove();
                 hideModal();
             });
        };

        const handleAddProcedure = (button) => {
            const list = button.closest('.procedure-table').querySelector('.procedure-list');
             showModal('Adicionar Procedimento', '<input type="text" id="modal-input" class="w-full border rounded p-2 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200" placeholder="Nome do procedimento">', 'Adicionar', () => {
                const input = document.getElementById('modal-input');
                const newName = input.value.trim();
                if (newName) {
                    list.insertAdjacentHTML('beforeend', createProcedureItemHTML(newName));
                }
                hideModal();
            });
        };

        const handleEditProcedure = (button) => {
            const item = button.closest('.procedure-item');
            const textSpan = item.querySelector('.procedure-text');
            const currentName = textSpan.textContent;
            showModal('Editar Procedimento', `<input type="text" id="modal-input" class="w-full border rounded p-2 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200" value="${currentName}">`, 'Salvar', () => {
                const input = document.getElementById('modal-input');
                const newName = input.value.trim();
                if (newName && newName !== currentName) {
                    textSpan.textContent = newName;
                    item.setAttribute('data-procedure-name', newName);
                }
                hideModal();
            });
        };

        const handleDeleteProcedure = (button) => {
            const item = button.closest('.procedure-item');
            const name = item.dataset.procedureName;
            showModal('Deletar Procedimento', `<p>Você tem certeza que quer deletar o procedimento "<strong>${name}</strong>"?</p>`, 'Deletar', () => {
                 item.remove();
                 hideModal();
             });
        };

        // --- Funções para Salvar / Exportar / Resetar ---
        const getCurrentData = () => {
            return Array.from(document.querySelectorAll('.procedure-table')).map(table => ({
                title: table.dataset.tableTitle,
                procedures: Array.from(table.querySelectorAll('.procedure-item')).map(item => item.dataset.procedureName)
            }));
        };
        
        const saveToLocalStorage = () => {
            localStorage.setItem('procedimentosData', JSON.stringify(getCurrentData()));
            showModal('Salvo com Sucesso!', '<p>Suas alterações foram salvas no cache do seu navegador.</p>', 'Ok', hideModal);
        };

        const exportToFile = () => {
            const currentData = getCurrentData();
            const fullHtml = document.documentElement.outerHTML;
            const dataAsJsonString = JSON.stringify(currentData, null, 4);
            const updatedHtml = fullHtml.replace(/const initialData = \[[\s\S]*?\];/, `const initialData = ${dataAsJsonString};`);
            const blob = new Blob([updatedHtml], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = 'procedimentos.html';
            document.body.appendChild(a); a.click();
            document.body.removeChild(a); URL.revokeObjectURL(url);
            showModal('Exportado com Sucesso!', '<p>Um novo arquivo HTML com os dados atuais foi baixado.</p>', 'Ok', hideModal);
        };
        
        const resetData = () => {
             showModal('Resetar Dados', '<p>Você tem certeza que quer apagar todos os dados salvos no navegador e voltar ao estado inicial?</p>', 'Resetar', () => {
                localStorage.removeItem('procedimentosData');
                location.reload();
             });
        };

        // --- Event Listeners ---
        addTableBtn.addEventListener('click', handleAddTable);
        saveBtn.addEventListener('click', saveToLocalStorage);
        exportBtn.addEventListener('click', exportToFile);
        resetBtn.addEventListener('click', resetData);
        tablesContainer.addEventListener('click', (e) => {
            const button = e.target.closest('button');
            if (!button) return;
            if (button.classList.contains('edit-table-btn')) handleEditTableTitle(button);
            else if (button.classList.contains('delete-table-btn')) handleDeleteTable(button);
            else if (button.classList.contains('add-procedure-btn')) handleAddProcedure(button);
            else if (button.classList.contains('edit-procedure-btn')) handleEditProcedure(button);
            else if (button.classList.contains('delete-procedure-btn')) handleDeleteProcedure(button);
        });
        
        // --- Inicialização ---
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme') || 'light';
            applyTheme(savedTheme);
            renderAllTables();
        });
    </script>
</body>
</html>

