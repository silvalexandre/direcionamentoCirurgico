<!DOCTYPE html>
<html lang="pt-BR" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Direcionamento de Cirurgia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = { darkMode: 'class' }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        html { scroll-behavior: smooth; }
        body { font-family: 'Inter', sans-serif; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        .dark ::-webkit-scrollbar-track { background: #374151; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
    </style>
</head>
<body class="p-4 md:p-8 bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300">

    <div id="app" class="max-w-full mx-auto">
        <header class="mb-8 p-4 bg-white dark:bg-gray-800 rounded-lg shadow-md">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800 dark:text-gray-100">Direcionamento de Cirurgias</h1>
                    <p class="text-gray-600 dark:text-gray-400 mt-1">Gerencie tabelas e procedimentos de forma interativa.</p>
                </div>
                <div class="mt-4 md:mt-0 flex flex-wrap items-center justify-center gap-3">
                    <button id="add-table-btn" class="w-full sm:w-auto bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-blue-700 transition">Criar Tabela</button>
                    <button id="suggestion-btn" class="w-full sm:w-auto bg-yellow-500 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-yellow-600 transition">Ver Sugestões</button>
                    <button id="save-btn" class="w-full sm:w-auto bg-green-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-green-700 transition">Salvar</button>
                    <button id="export-btn" class="w-full sm:w-auto bg-purple-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-purple-700 transition">Exportar</button>
                    <button id="reset-btn" class="w-full sm:w-auto bg-red-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-red-700 transition">Resetar</button>
                    <button id="theme-toggle-btn" title="Alternar tema" class="p-2 rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 focus:outline-none">
                        <svg id="theme-toggle-moon-icon" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                        <svg id="theme-toggle-sun-icon" class="w-6 h-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                    </button>
                </div>
            </div>
            <div class="mt-6">
                <div class="relative"><div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><svg class="w-5 h-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" /></svg></div><input type="text" id="search-input" class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200 placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500" placeholder="Pesquisar..."></div>
            </div>
            <div class="mt-4 p-3 bg-blue-100 dark:bg-gray-700 border-l-4 border-blue-500 text-blue-800 dark:text-blue-300 rounded-md">
                <p class="font-bold">Como funciona?</p><p>Altere os contadores e o estoque alvo. Suas alterações são salvas automaticamente no navegador. Clique em <strong class="font-semibold">"Salvar"</strong> para confirmar ou <strong class="font-semibold">"Exportar"</strong> para baixar um novo arquivo.</p>
            </div>
        </header>

        <main id="tables-container" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"></main>

        <section id="suggestion-section" class="mt-12 p-4 bg-white dark:bg-gray-800 rounded-lg shadow-md">
            <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-100 mb-4">Sugestões de Confecção de Kits</h2>
            <div id="suggestion-content"></div>
        </section>
    </div>

    <div id="modal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center p-4 z-50">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md">
            <h3 id="modal-title" class="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-100"></h3>
            <div id="modal-content" class="text-gray-700 dark:text-gray-300"></div>
            <div class="mt-6 flex justify-end gap-3"><button id="modal-cancel" class="bg-gray-300 dark:bg-gray-600 text-gray-800 dark:text-gray-100 font-semibold py-2 px-4 rounded-lg hover:bg-gray-400 dark:hover:bg-gray-500 transition">Cancelar</button><button id="modal-confirm" class="bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700 transition">Confirmar</button></div>
        </div>
    </div>

    <script>
        const initialData = [
            { title: "UROLOGIA PEQUENO", procedures: ["VASECTOMIA", "POSTECTOMIA", "CISTOSCOPIA", "VARICOCELE", "HIDROCELE"], stock: 0, targetStock: 10 },
            { title: "UROLOGIA MÉDIO", procedures: ["MEATOPLASTIA", "PROSTATECTOMIA", "CISTOTOMIA", "ORQUIECTOMIA", "URETERORRENOLITOTRIPSIA", "NEFRECTOMIA TOTAL", "URETROTOMIA", "RTU DE PRÓSTATA", "LOMBOTOMIA"], stock: 6, targetStock: 10 },
            { title: "UROLOGIA GRANDE", procedures: ["RADICAL DE PRÓSTATA", "NEFRECTOMIA", "PIELOPLASTIA", "RTU DE PRÓSTATA"], stock: 0, targetStock: 5 },
            { title: "PEQUENO PROCEDIMENTO", procedures: ["DRENAGEMDE ABCESSO", "BRONCOSCOPIA", "VARIZES", "EXERESE DE TUMOR DE PELE", "RECONSTRUÇÃO COM RETALHO MIOCUTÂNIO", "ENXERTO DE PELE", "EXCISÃO E SUTURA DE LESÃO NA PELE EM Z OU ROTACA", "Linfadenectomia inguinal"], stock: 0, targetStock: 15 },
            { title: "CÁRDIO", procedures: ["REVASCULARIZAÇÃO", "IMPLANTE DE PROTESE VALVAR"], stock: 0, targetStock: 2 },
            { title: "DESBRIDAMENTO", procedures: ["CURATIVO/DESBRIDAMENTO", "RESSUTURA DE PAREDE"], stock: 0, targetStock: 10 },
            { title: "EXODONTIA", procedures: ["EXODONTIA"], stock: 0, targetStock: 5 },
            { title: "TQT", procedures: ["TRAQUEOSTOMIA"], stock: 0, targetStock: 5 },
            { title: "NEURO", procedures: ["MICROCIRURGIA PARA TUMOR/ANEURISMA INTRACRANIANO/CRANIOTOMIA", "ARTRODESE CERVICAL"], stock: 0, targetStock: 3 },
            { title: "OTORRINO", procedures: ["AMIGDALECTOMIA"], stock: 0, targetStock: 5 },
            { title: "AMPUTAÇÃO", procedures: ["AMPUTAÇÃO"], stock: 0, targetStock: 5 },
            { title: "CPRE", procedures: ["COLANGIOPANCREATOGRAFIA"], stock: 0, targetStock: 5 }
        ];

        const tablesContainer = document.getElementById('tables-container');
        const saveBtn = document.getElementById('save-btn');
        const addTableBtn = document.getElementById('add-table-btn');
        const exportBtn = document.getElementById('export-btn');
        const resetBtn = document.getElementById('reset-btn');
        const themeToggleBtn = document.getElementById('theme-toggle-btn');
        const moonIcon = document.getElementById('theme-toggle-moon-icon');
        const sunIcon = document.getElementById('theme-toggle-sun-icon');
        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modal-title');
        const modalContent = document.getElementById('modal-content');
        const modalCancelBtn = document.getElementById('modal-cancel');
        const modalConfirmBtn = document.getElementById('modal-confirm');
        const searchInput = document.getElementById('search-input');
        const suggestionBtn = document.getElementById('suggestion-btn');
        const suggestionSection = document.getElementById('suggestion-section');
        const suggestionContent = document.getElementById('suggestion-content');

        let onConfirmCallback = null;
        
        const applyTheme = (theme) => {
            const isDark = theme === 'dark';
            document.documentElement.classList.toggle('dark', isDark);
            moonIcon.classList.toggle('hidden', isDark);
            sunIcon.classList.toggle('hidden', !isDark);
        };
        
        const showModal = (title, contentHtml, confirmText = 'Confirmar', onConfirm) => {
            modalTitle.textContent = title;
            modalContent.innerHTML = contentHtml;
            modalConfirmBtn.textContent = confirmText;
            onConfirmCallback = onConfirm;
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            modal.querySelector('input')?.focus();
        };

        const hideModal = () => {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            onConfirmCallback = null;
            modalContent.innerHTML = '';
        };

        const createProcedureItemHTML = (text) => `
            <li class="procedure-item bg-white dark:bg-gray-800 flex justify-between items-center p-3 rounded-md shadow-sm mb-2" data-procedure-name="${text}">
                <span class="procedure-text flex-1 pr-2 text-gray-800 dark:text-gray-200">${text}</span>
                <div class="flex items-center gap-2">
                    <button class="edit-procedure-btn text-gray-500 hover:text-blue-600 dark:hover:text-blue-400" title="Editar procedimento"><svg class="pointer-events-none" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg></button>
                    <button class="delete-procedure-btn text-gray-500 hover:text-red-600 dark:hover:text-red-400" title="Deletar procedimento"><svg class="pointer-events-none" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg></button>
                </div>
            </li>`;
        
        const createTableHTML = (title, procedures = [], stockCount = 0, targetStock = 10) => {
            const tableEl = document.createElement('div');
            tableEl.className = 'procedure-table bg-gray-200 dark:bg-gray-700 rounded-xl p-4 shadow-lg flex flex-col h-full';
            tableEl.dataset.tableTitle = title;
            tableEl.dataset.stockCount = stockCount;
            tableEl.dataset.targetStock = targetStock;
            const proceduresHTML = procedures.map(proc => createProcedureItemHTML(proc)).join('');
            const sanitizedTitleId = title.replace(/\s+/g, '-');
            
            tableEl.innerHTML = `
                <header class="flex flex-wrap justify-between items-center gap-4 mb-4 pb-2 border-b-2 border-gray-300 dark:border-gray-600">
                    <h2 class="table-title text-xl font-bold text-gray-700 dark:text-gray-200">${title}</h2>
                    <div class="flex items-center gap-2">
                        <button class="stock-minus-btn bg-red-500 text-white rounded-full w-7 h-7 flex items-center justify-center font-bold text-xl hover:bg-red-600 transition">-</button>
                        <span class="stock-count-display text-lg font-bold w-10 text-center">${stockCount}</span>
                        <button class="stock-plus-btn bg-green-500 text-white rounded-full w-7 h-7 flex items-center justify-center font-bold text-xl hover:bg-green-600 transition">+</button>
                    </div>
                    <div class="flex items-center gap-2">
                        <label for="target-stock-${sanitizedTitleId}" class="text-sm font-semibold">Alvo:</label>
                        <input type="number" min="0" id="target-stock-${sanitizedTitleId}" class="target-stock-input w-20 text-center bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 rounded-md border border-gray-300 dark:border-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500" value="${targetStock}">
                    </div>
                    <div class="flex items-center gap-2">
                        <button class="edit-table-btn text-gray-500 hover:text-blue-600 dark:hover:text-blue-400" title="Editar título"><svg class="pointer-events-none" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg></button>
                        <button class="delete-table-btn text-gray-500 hover:text-red-600 dark:hover:text-red-400" title="Deletar tabela"><svg class="pointer-events-none" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 4H8l-7 8 7 8h13a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z"></path><line x1="18" y1="9" x2="12" y2="15"></line><line x1="12" y1="9" x2="18" y2="15"></line></svg></button>
                    </div>
                </header>
                <ul class="procedure-list flex-grow overflow-y-auto pr-1" style="max-height: 60vh;">${proceduresHTML}</ul>
                <footer class="mt-4"><button class="add-procedure-btn w-full bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-200 font-semibold py-2 px-4 rounded-lg hover:bg-gray-400 dark:hover:bg-gray-500 transition">Adicionar Procedimento</button></footer>
            `;
            return tableEl;
        };
        
        const renderSuggestions = () => {
            const currentData = getCurrentData();
            const suggestions = currentData.filter(table => table.stock < table.targetStock);
            if (suggestions.length === 0) {
                suggestionContent.innerHTML = '<p class="text-green-600 dark:text-green-400 font-semibold text-center py-4">Tudo em ordem! Não há sugestões de confecção.</p>';
                return;
            }

            // --- INÍCIO DA MODIFICAÇÃO PARA O NOVO LAYOUT RESPONSIVO ---
            let suggestionsHTML = `
                <div class="overflow-x-auto rounded-lg border border-gray-200 dark:border-gray-700">
                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                        <thead class="bg-gray-200 dark:bg-gray-600">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Kit / Tabela</th>
                                <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Estoque Atual</th>
                                <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Estoque Alvo</th>
                                <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">A Confeccionar</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
            `;
            suggestions.forEach(suggestion => {
                const needed = suggestion.targetStock - suggestion.stock;
                suggestionsHTML += `
                            <tr class="hover:bg-gray-100 dark:hover:bg-gray-700">
                                <td class="px-6 py-4 whitespace-nowrap font-medium text-gray-900 dark:text-white">${suggestion.title}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-center text-gray-700 dark:text-gray-300">${suggestion.stock}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-center text-gray-700 dark:text-gray-300">${suggestion.targetStock}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-center font-bold text-xl text-yellow-600 dark:text-yellow-400">${needed}</td>
                            </tr>
                `;
            });
            suggestionsHTML += '</tbody></table></div>';
            suggestionContent.innerHTML = suggestionsHTML;
            // --- FIM DA MODIFICAÇÃO ---
        };

        const renderAllTables = () => {
            tablesContainer.innerHTML = '';
            const savedData = localStorage.getItem('procedimentosData');
            let dataToRender = savedData ? JSON.parse(savedData) : initialData;
            dataToRender.forEach(tableData => {
                const stock = tableData.stock || 0;
                const targetStock = tableData.targetStock || 10;
                tablesContainer.appendChild(createTableHTML(tableData.title, tableData.procedures, stock, targetStock));
            });
            renderSuggestions();
        };
        
        const handleSearch = () => {
             const searchTerm = searchInput.value.toLowerCase().trim();
             document.querySelectorAll('.procedure-table').forEach(table => {
                 const title = table.dataset.tableTitle.toLowerCase();
                 let tableVisible = title.includes(searchTerm);
                 table.querySelectorAll('.procedure-item').forEach(item => {
                     const procName = item.dataset.procedureName.toLowerCase();
                     const isMatch = searchTerm && procName.includes(searchTerm);
                     item.classList.toggle('bg-green-200', isMatch);
                     item.classList.toggle('dark:bg-green-800', isMatch);
                     item.classList.toggle('bg-white', !isMatch);
                     item.classList.toggle('dark:bg-gray-800', !isMatch);
                     if (isMatch) tableVisible = true;
                 });
                 table.classList.toggle('hidden', !tableVisible && searchTerm);
             });
        };
        
        const handleAddTable = () => showModal('Criar Tabela', `<input type="text" id="modal-input" class="w-full border rounded p-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 uppercase focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Nome da tabela">`, 'Criar', () => { const newTitle = document.getElementById('modal-input').value.trim().toUpperCase(); if(newTitle) { tablesContainer.appendChild(createTableHTML(newTitle)); hideModal(); renderSuggestions(); }});
        const handleEditTableTitle = (button) => {
            const tableEl = button.closest('.procedure-table');
            const titleEl = tableEl.querySelector('.table-title');
            const currentTitle = titleEl.textContent;
            showModal('Editar Título', `<input type="text" id="modal-input" class="w-full border rounded p-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 uppercase focus:outline-none focus:ring-2 focus:ring-blue-500" value="${currentTitle}">`, 'Salvar', () => { const newTitle = document.getElementById('modal-input').value.trim().toUpperCase(); if(newTitle) { titleEl.textContent = newTitle; tableEl.dataset.tableTitle = newTitle; renderSuggestions(); } hideModal(); });
        };
        const handleDeleteTable = (button) => showModal('Deletar Tabela', `<p>Deletar "<strong>${button.closest('.procedure-table').dataset.tableTitle}</strong>"?</p>`, 'Deletar', () => { button.closest('.procedure-table').remove(); hideModal(); renderSuggestions(); });
        const handleAddProcedure = (button) => {
            const list = button.closest('.procedure-table').querySelector('.procedure-list');
            showModal('Adicionar Procedimento', '<input type="text" id="modal-input" class="w-full border rounded p-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 uppercase focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Nome do procedimento">', 'Adicionar', () => { const newName = document.getElementById('modal-input').value.trim().toUpperCase(); if(newName) { list.insertAdjacentHTML('beforeend', createProcedureItemHTML(newName)); } hideModal(); });
        };
        const handleEditProcedure = (button) => {
            const item = button.closest('.procedure-item');
            const textSpan = item.querySelector('.procedure-text');
            const currentName = textSpan.textContent;
            showModal('Editar Procedimento', `<input type="text" id="modal-input" class="w-full border rounded p-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 uppercase focus:outline-none focus:ring-2 focus:ring-blue-500" value="${currentName}">`, 'Salvar', () => { const newName = document.getElementById('modal-input').value.trim().toUpperCase(); if(newName) { textSpan.textContent = newName; item.dataset.procedureName = newName; } hideModal(); });
        };
        const handleDeleteProcedure = (button) => showModal('Deletar Procedimento', `<p>Deletar "<strong>${button.closest('.procedure-item').dataset.procedureName}</strong>"?</p>`, 'Deletar', () => { button.closest('.procedure-item').remove(); hideModal(); });
        
        const getCurrentData = () => Array.from(document.querySelectorAll('.procedure-table')).map(table => ({ title: table.dataset.tableTitle, procedures: Array.from(table.querySelectorAll('.procedure-item')).map(item => item.dataset.procedureName), stock: parseInt(table.dataset.stockCount, 10) || 0, targetStock: parseInt(table.dataset.targetStock, 10) || 10 }));
        const saveToLocalStorage = () => { localStorage.setItem('procedimentosData', JSON.stringify(getCurrentData())); showModal('Salvo!', 'Suas alterações foram salvas.', 'Ok', hideModal); };
        const exportToFile = () => {
            const blob = new Blob([document.documentElement.outerHTML.replace(/const initialData = \[[\s\S]*?\];/, `const initialData = ${JSON.stringify(getCurrentData(), null, 4)};`)], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = 'procedimentos.html';
            a.click();
            URL.revokeObjectURL(url);
            a.remove();
            showModal('Exportado!', 'Um novo arquivo HTML foi baixado.', 'Ok', hideModal);
        };
        const resetData = () => showModal('Resetar Dados', '<p>Voltar ao estado inicial e apagar dados salvos?</p>', 'Resetar', () => { localStorage.removeItem('procedimentosData'); location.reload(); });

        // --- Event Listeners ---
        addTableBtn.addEventListener('click', handleAddTable);
        saveBtn.addEventListener('click', saveToLocalStorage);
        exportBtn.addEventListener('click', exportToFile);
        resetBtn.addEventListener('click', resetData);
        searchInput.addEventListener('input', handleSearch);
        suggestionBtn.addEventListener('click', () => { suggestionSection.scrollIntoView({ behavior: 'smooth' }); });
        themeToggleBtn.addEventListener('click', () => {
            const newTheme = document.documentElement.classList.toggle('dark') ? 'dark' : 'light';
            localStorage.setItem('theme', newTheme);
            applyTheme(newTheme);
        });
        modalCancelBtn.addEventListener('click', hideModal);
        modalConfirmBtn.addEventListener('click', () => { if (onConfirmCallback) onConfirmCallback(); });
        modal.addEventListener('keydown', (e) => { if (e.key === 'Enter') { e.preventDefault(); if (onConfirmCallback) onConfirmCallback(); } else if (e.key === 'Escape') { hideModal(); } });
        
        tablesContainer.addEventListener('click', (e) => {
            const button = e.target.closest('button');
            if (!button) return;
            const classList = button.classList;
            if (classList.contains('stock-plus-btn') || classList.contains('stock-minus-btn')) {
                const tableEl = button.closest('.procedure-table');
                let count = parseInt(tableEl.dataset.stockCount, 10);
                count += classList.contains('stock-plus-btn') ? 1 : -1;
                if (count >= 0) {
                    tableEl.dataset.stockCount = count;
                    tableEl.querySelector('.stock-count-display').textContent = count;
                    renderSuggestions();
                }
            } 
            else if (classList.contains('edit-table-btn')) { handleEditTableTitle(button); }
            else if (classList.contains('delete-table-btn')) { handleDeleteTable(button); }
            else if (classList.contains('add-procedure-btn')) { handleAddProcedure(button); }
            else if (classList.contains('edit-procedure-btn')) { handleEditProcedure(button); }
            else if (classList.contains('delete-procedure-btn')) { handleDeleteProcedure(button); }
        });
        
        tablesContainer.addEventListener('input', (e) => {
            const target = e.target;
            if (target.classList.contains('target-stock-input')) {
                const tableEl = target.closest('.procedure-table');
                tableEl.dataset.targetStock = target.value;
                renderSuggestions();
            }
        });

        // --- Inicialização ---
        const savedTheme = localStorage.getItem('theme') || 'light';
        applyTheme(savedTheme);
        renderAllTables();
    </script>
</body>
</html>
